/*! df-tab-menu - v0.3.0 - Responsive tabs with dropdown menu - built 2015-10-08 - License MIT (http://www.opensource.org/licenses/MIT) */
!function(){"use strict";angular.module("digitalfondue.dftabmenu",[]).directive("dfTabMenu",["$window","$timeout","haparaClientBus",function(a,b,c){return{restrict:"A",priority:2001,compile:function(d,e,f){function g(a){return l?a:""}function h(a){return m?a:""}var i=a.document,j=d[0],k=j.tagName;if("UL"!==k&&"OL"!==k)throw"Wrong element: only OL and UL are supported by df-tab-menu";var l="bootstrap"===e.theme,m="bootstrap"===e.themeDropDownMenu;angular.element(j).attr("role","tablist").addClass("df-tab-menu "+g("nav nav-tabs"));var n=angular.element(j.querySelector("li[data-more-menu-item]"));n.attr({role:"presentation"}),n.addClass(g("dropdown")),n.addClass(h("dropdown")),n.children().attr({"dropdown-toggle":"","aria-haspopup":"true","aria-expanded":"false"}),n.children().addClass("dropdown-toggle"),n.append("<"+k+' role="menu" aria-hidden="true" class="df-tab-menu-dropdown '+g("dropdown-menu")+h("dropdown-menu")+'"></'+k+">");for(var o=angular.element(j.querySelector(".df-tab-menu-dropdown")),p=j.querySelectorAll("li[data-menu-item]"),q=angular.element(p),r=0;r<q.length;r++){var s=angular.element(p[r]).clone();s.attr({role:"menuitem"}),o.append(s),angular.element(p[r]).attr({role:"presentation"}),angular.element(p[r]).children().attr({"aria-selected":"false",role:"tab"})}return function(d,e,f){var g=e[0],h=angular.element(a),j=!1,k=function(){var a=g.querySelectorAll("li[data-menu-item][role=presentation]");angular.element(a).removeClass("ng-hide");for(var b=[],c=0;c<a.length;c++){var d=a[c].offsetWidth;d>0&&(b[c]=a[c].offsetWidth)}return b},m=(d.$watch(function(){var a=g.querySelector("li[role=presentation].df-tab-menu-active");return null!=a?a.scrollWidth:0},function(a,b){null!=a&&a>0&&p()},!0),function(){return angular.element(g.querySelector("li[data-more-menu-item]")).removeClass("ng-hide"),g.querySelector("li[data-more-menu-item]").offsetWidth}),n=function(a,b){var c=[],d=k(),e=d[b]+m()+40;c.push(b);for(var f=g.querySelectorAll("li[data-menu-item][role=presentation]"),h=0;h<f.length;h++)if(h!=b){if(e+=d[h],e>a)return c;c.push(h)}return c},o=function(){for(var a=g.querySelectorAll("li[data-menu-item][role=presentation]"),b=0;b<a.length;b++)if(angular.element(a[b]).hasClass("df-tab-menu-active"))return b;return 0},p=function(){var a=g.offsetWidth,b=o(),c=n(a,b),d=g.querySelectorAll("li[data-menu-item][role=presentation]"),e=g.querySelectorAll("li[role=menuitem]"),f=g.querySelector("li[data-more-menu-item]");if(c.length<g.querySelectorAll("li[data-menu-item][role=presentation]").length){angular.element(f).removeClass("ng-hide").attr("aria-hidden","false");for(var h=0;h<d.length;h++)-1!=c.indexOf(h)?(angular.element(d[h]).removeClass("ng-hide").attr("aria-hidden","false"),angular.element(e[h]).addClass("ng-hide").attr("aria-hidden","true")):(angular.element(d[h]).addClass("ng-hide").attr("aria-hidden","true"),angular.element(e[h]).removeClass("ng-hide").attr("aria-hidden","false"))}else angular.element(f).addClass("ng-hide").attr("aria-hidden","true"),angular.element(d).removeClass("ng-hide").attr("aria-hidden","false"),j=!1,r()},q=function(a){j=!1,r(a)},r=function(){j?(l&&angular.element(g.querySelector("li[data-more-menu-item]")).addClass("open"),angular.element(g.querySelector("li[data-more-menu-item] [dropdown-toggle]")).addClass("df-tab-menu-dropdown-open").attr({"aria-expanded":"true"}),angular.element(i).bind("click",q)):(l&&angular.element(g.querySelector("li[data-more-menu-item]")).removeClass("open"),angular.element(g.querySelector("li[data-more-menu-item] [dropdown-toggle]")).removeClass("df-tab-menu-dropdown-open").attr({"aria-expanded":"false"}),angular.element(i).unbind("click",q))},s=function(a){a&&a.stopPropagation(),j=!j,r()};angular.element(g.querySelector("li[data-more-menu-item] [dropdown-toggle]")).bind("click",s);var t=function(a){var b=angular.element(g.querySelector("li.df-tab-menu-active")).removeClass("df-tab-menu-active");b.children().attr("aria-selected","false");var c=angular.element(g.querySelector('li[data-menu-item="'+a+'"][role=presentation]')).addClass("df-tab-menu-active");c.children().attr("aria-selected","true"),l&&(b.removeClass("active"),c.addClass("active"))};f.$observe("menuControl",function(a){p(),t(a)}),h.bind("resize",p),d.$on("$destroy",function(){h.unbind("resize",p),angular.element(g.querySelector("li[data-more-menu-item] [dropdown-toggle]")).unbind("click",s),angular.element(i).unbind("click",q)});var u=function(){b(function(){p(),t(f.menuControl);var a=g.querySelector("li[data-more-menu-item]");angular.element(a).removeClass("invisible").attr("aria-hidden","false")},0,!1)};c.register({key:"hapara-shared-group-view-change"},function(a){var b=g.querySelector("li[data-more-menu-item]");angular.element(b).addClass("invisible").attr("aria-hidden","true"),u()})}}}}])}();